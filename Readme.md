## Логика анализа текста

В программе присутствуют два критерия оценки текста:
- `redflags` - если в тексте присутствует хотя бы одна фраза, словосочетание или слово, содержащиеся в `redflags`, 
то текст обозначается *100% попадающим под фильтр* и отправляется дальше.  
`redflags` - список, хранящийся в файле `FLAGS.json` по ключу `redflags`.
- `yellowflags` - если в лемматизированном тексте присутствует более `N` слов из `yellowflags`, 
то текст обозначается как *возможно попадающим под фильтр* и отправляется дальше.  
`yellowflags` - список, хранящийся в файле `FLAGS.json` по ключу `yellowflags`.

## Логика функций

1. `get_posts` - получает на вход домен и отправляет `get` запрос, получая в ответе `100 постов`.  
   - Во-первых, функция проверяет дату публикации поста. 
   Если дата поста != сегодняшняя дата, то текущий и все следующие за ним посты пропускаются.  
   - Во-вторых, функция проверяет сырой текст на наличие `redflags`.
     - Если `redflags` не найдены, то лемметизирует текст и проверяет `yellowflags`. 
       - Если найдено более `N` `yellowflags`, то помечает текст как `yellowflag` 
         и добавляет в словарь, который добавляется в список `result`.
       - В противном случае пропускает этот комментарий.
     - В противном случае помечает текст как `redflag` И добавляет в словарь, который добавляется в список `result`.
   - В-третьих, возвращает следующие данные:
     - `ID поста`
     - `ID группы`
     - `flag type`
     - `ID Автора поста` (_Optional_)
     - `Текст поста`

2. `get_comments` - получает на вход `ID поста` и `ID группы` и отправляет `get` запрос, 
получая в ответе все комментарии.
   - Во-первых, функция проверяет текст комментария на `redflags`. 
     - Если `redflags` не найдены - лемметизирует текст и проверяет на `yellowflags`.
       - Если найдено более `N` `yellowflags`, то помечает текст как `yellowflag`
       - В противном случае пропускает сообщение.
     - Если найдены - помечает комментарий как `redflag`.
   - Во-вторых, 
     - Если текст комментария попал под один из фильтров, то проверяется каждый комментарий из обсуждения.
     - Если нет, то комментарий пропускается
   - В-третьих, функция возвращает следующие значения:
     - `ID Автора комментария`
     - `Текст комментария`
     - `flag type`
     - `Ответы на комментарий`:
       - `ID ответившего`
       - `Текст ответа`
       - `flag type`
   - В-четвертых, функция отправляет данные сразу в две функции `get_users` (_пункт 3_) и `get_groups` (_пункт 4_).

3. `get_users` - получает на вход `ID пользователя` и отправляет `get` запрос, 
получая в ответе информацию о пользователях, которую потом возвращает:
   - Имя
   - Фамилия
   - Ссылка на фото
   - Город (Optional)
   - Страна (Optional)
   - Дата рождения (Optional)
   - Пол (Optional)

4. `get_groups` - получает на вход `ID пользователя` и отправляет `get` запрос, 
получая в ответе все группы пользователя в виде списка.  
Добавляет группы в глобальный словарь, инвертируя модель, в которой Пользователь был объектом, а группа атрибутом.  
В словарь по ключу `ID группы` добавляется ссылка на пользователя.


Общие заметки по проекту:

### Папка static 
Настоятельно рекомендую сделать папку static и уже в ней работать со стилями. А ещё лучше - выбрать один из фреймворков
- bootstrap
- material ui
- antd

И работать уже с ним

### Работа со ссылками
У jinja2 в fastapi есть такая замечательная вещь как url_for (это я про search.html)
Туда же советую закинуть ошибки валидации, которые 100% будут

### Структура проекта
по структуре самой очень советую вообще сначала зачитаться в *"Чистую Архитектуру" Роберта Мартина*
Но вообще есть замечательная картинка которая всё наглядно показывает
![](https://raw.githubusercontent.com/Sairyss/domain-driven-hexagon/master/assets/images/DomainDrivenHexagon.png)

### Docker-compose
C компоузом тоже очень рекомендую лишний раз заморочиться и сделать Dockerfile 
Кстати скорее всего закину сейчас

### Конфиги
Менеджмент конфигов я лично делаю в отдельной папочке src/deploy. Так как минимум выглядит более структурированно

### Poetry
Так будет гораздо проще и не придётся venv таскать кругом. Я проект инициализирую, но постарайся дальше уже сам тоже взять в привычку

### Линтеры и форматирование!
**Важный момент.** Добавил в дев-зависимости и сделал makefile, чтобы можно было удобно вызвать команду
```shell
make format
# или
make flake
```
И пробежаться хотя бы такими вещами по коду. Позже советую посмотреть **mypy**

#### Voilà! По идее, самое главное даже не упустил
